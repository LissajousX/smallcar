<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>SmallCar 远程控制面板V1.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
</head>
<body>
  <header class="top-bar">
    <h1>
      <img src="favicon.svg" alt="SmallCar" class="logo-icon" />
      <span>SmallCar 远程控制V1.0</span>
    </h1>
    <div class="top-right">
      <div class="ws-config">
        <label class="ws-label">
          <span>WS地址：</span>
          <input
            id="ws-url"
            class="top-pill-input"
            type="text"
            value="ws://192.168.31.140:8765/ws_control"
          />
        </label>
        <button id="ws-connect-btn">连接</button>
        <span id="ws-status" class="status status-disconnected">未连接</span>
      </div>
    </div>
  </header>

  <main class="layout">
    <section class="panel panel-video">
      <div class="video-header">
        <label class="video-url-label">
          视频流地址：
          <input
            id="video-url"
            class="top-pill-input"
            type="text"
            value="http://192.168.31.140:81/stream"
            placeholder="如 http://ESP32_IP:PORT/stream"
          />
        </label>
        <button id="video-load-btn">加载</button>
      </div>
      <div class="video-box">
        <img id="video-view" alt="视频预览" src="placeholder-video.svg" />
        <div class="video-tools">
          <button id="video-snapshot-btn" class="video-tool-btn" aria-label="拍照">
            <span class="video-tool-icon camera-icon"></span>
          </button>
          <button id="video-light-btn" class="video-tool-btn" aria-label="灯光">
            <span class="video-tool-icon light-icon"></span>
          </button>
          <button id="video-advanced-btn" class="video-tool-btn" aria-label="高级设置">
            <span class="video-tool-icon settings-icon"></span>
          </button>
        </div>
        <div id="video-light-slider" class="video-light-slider">
          <input id="video-light-level" type="range" min="0" max="255" value="125" />
        </div>
        <div id="video-play-overlay" class="video-play-overlay">
          <button id="video-play-btn" class="video-play-btn" aria-label="加载视频"></button>
        </div>
        <div id="video-play-controls" class="video-play-controls">
          <button id="video-play-toggle" class="video-play-toggle-btn" aria-label="播放/暂停视频"></button>
        </div>
        <div class="video-overlay">
          <div class="overlay-panel overlay-drive">
            <div class="overlay-header">
              <div class="overlay-title">小车</div>
              <button id="ov-speed-gear" class="overlay-speed-btn">速：<span id="ov-speed-label">中</span></button>
            </div>
            <div class="overlay-dpad">
              <div class="overlay-row">
                <button id="ov-drive-nw" class="overlay-btn">↖</button>
                <button id="ov-drive-forward" class="overlay-btn">↑</button>
                <button id="ov-drive-ne" class="overlay-btn">↗</button>
              </div>
              <div class="overlay-row">
                <button id="ov-drive-left" class="overlay-btn">←</button>
                <button id="ov-drive-stop" class="overlay-btn">■</button>
                <button id="ov-drive-right" class="overlay-btn">→</button>
              </div>
              <div class="overlay-row">
                <button id="ov-drive-sw" class="overlay-btn">↙</button>
                <button id="ov-drive-backward" class="overlay-btn">↓</button>
                <button id="ov-drive-se" class="overlay-btn">↘</button>
              </div>
            </div>
          </div>
          <div class="overlay-panel overlay-gimbal">
            <div class="overlay-title">云台</div>
            <div class="overlay-dpad">
              <div class="overlay-row">
                <button id="ov-gimbal-up" class="overlay-btn">↑</button>
              </div>
              <div class="overlay-row">
                <button id="ov-gimbal-left" class="overlay-btn">←</button>
                <button id="ov-gimbal-center" class="overlay-btn">◎</button>
                <button id="ov-gimbal-right" class="overlay-btn">→</button>
              </div>
              <div class="overlay-row">
                <button id="ov-gimbal-down" class="overlay-btn">↓</button>
              </div>
            </div>
          </div>
          <div class="overlay-status-chip">
            T<span id="ov-status-throttle">0</span>
            S<span id="ov-status-steer">0</span>
            Y<span id="ov-status-yaw">90</span>°
            P<span id="ov-status-pitch">90</span>°
          </div>
        </div>
      </div>
    </section>

    <section class="panel panel-status">
      <div class="panel-status-header">
        <h2>当前状态</h2>
        <span class="status-fw-build">
          ESP32-CAM 固件：
          <span id="status-fw-build">--</span>
        </span>
      </div>
      <div class="status-grid">
        <div class="status-item">
          <div class="status-label">油门 / 转向 / 云台角度</div>
          <div class="status-value">
            T<span id="status-throttle">0</span>
            S<span id="status-steer">0</span>
            Y<span id="status-yaw">90</span>°
            P<span id="status-pitch">90</span>°
          </div>
        </div>
        <div class="status-thumb">
          <img id="snapshot-thumb" src="placeholder-video.svg" alt="缩略图预览" />
        </div>
      </div>
    </section>

    <section class="panel panel-controls">
      <div class="panel-controls-grid">
        <section class="panel panel-drive">
          <div class="panel-drive-header">
            <h2>小车运动</h2>
            <button id="btn-speed-gear" class="small-btn">速度：<span id="speed-gear-label">中</span></button>
          </div>

          <div class="direction-pad">
            <div class="direction-row">
              <button id="btn-drive-nw" class="direction-btn">
                <span class="dir-arrow">↖</span>
                <span class="dir-key">Q</span>
              </button>
              <button id="btn-forward" class="direction-btn">
                <span class="dir-arrow">↑</span>
                <span class="dir-key">W</span>
              </button>
              <button id="btn-drive-ne" class="direction-btn">
                <span class="dir-arrow">↗</span>
                <span class="dir-key">E</span>
              </button>
            </div>
            <div class="direction-row">
              <button id="btn-left" class="direction-btn">
                <span class="dir-arrow">←</span>
                <span class="dir-key">A</span>
              </button>
              <button id="btn-stop" class="direction-btn danger">
                <span class="dir-arrow">■</span>
                <span class="dir-key">S</span>
              </button>
              <button id="btn-right" class="direction-btn">
                <span class="dir-arrow">→</span>
                <span class="dir-key">D</span>
              </button>
            </div>
            <div class="direction-row">
              <button id="btn-drive-sw" class="direction-btn">
                <span class="dir-arrow">↙</span>
                <span class="dir-key">Z</span>
              </button>
              <button id="btn-backward" class="direction-btn">
                <span class="dir-arrow">↓</span>
                <span class="dir-key">X</span>
              </button>
              <button id="btn-drive-se" class="direction-btn">
                <span class="dir-arrow">↘</span>
                <span class="dir-key">C</span>
              </button>
            </div>
          </div>

          <div class="field field-slider">
            <label for="throttle">油门（前进/后退）：<span id="throttle-value">0</span></label>
            <input id="throttle" type="range" min="-100" max="100" value="0" />
            <div class="hint">负数：后退，正数：前进；范围 -100..100。</div>
          </div>

          <div class="field field-slider">
            <label for="steer">转向（左/右）：<span id="steer-value">0</span></label>
            <input id="steer" type="range" min="-100" max="100" value="0" />
            <div class="hint">负数：向左；正数：向右；范围 -100..100。</div>
          </div>
        </section>

        <section class="panel panel-gimbal">
          <h2>云台控制</h2>

          <div class="gimbal-pad">
            <div class="direction-row">
              <button id="btn-gimbal-up" class="direction-btn">↑</button>
            </div>
            <div class="direction-row">
              <button id="btn-gimbal-left" class="direction-btn">←</button>
              <button id="btn-center-gimbal" class="direction-btn">◎</button>
              <button id="btn-gimbal-right" class="direction-btn">→</button>
            </div>
            <div class="direction-row">
              <button id="btn-gimbal-down" class="direction-btn">↓</button>
            </div>
          </div>

          <div class="field field-slider">
            <label for="yaw">水平角 Yaw：<span id="yaw-value">90</span>°</label>
            <input id="yaw" type="range" min="15" max="165" value="90" />
          </div>

          <div class="field field-slider">
            <label for="pitch">俯仰角 Pitch：<span id="pitch-value">90</span>°</label>
            <input id="pitch" type="range" min="15" max="150" value="90" />
          </div>
        </section>
      </div>
    </section>
  </main>

  <div id="snapshot-modal" class="snapshot-modal">
    <div class="snapshot-modal-content">
      <button id="snapshot-modal-close" class="snapshot-modal-close" aria-label="关闭预览">×</button>
      <img id="snapshot-modal-img" alt="照片预览" />
      <div class="snapshot-modal-hint">长按（手机）或右键（电脑）图片可以保存到本地</div>
    </div>
  </div>

  <div id="cam-advanced-modal" class="snapshot-modal">
    <div class="snapshot-modal-content cam-advanced-modal-content">
      <button id="cam-advanced-close" class="snapshot-modal-close" aria-label="关闭高级设置">×</button>
      <section class="panel panel-advanced">
        <h2>摄像头高级设置</h2>
        <div class="field">
          <label for="cam-preset">画质预设：</label>
          <select id="cam-preset" class="top-pill-input">
            <option value="low">流畅（低延迟）</option>
            <option value="normal" selected>平衡</option>
            <option value="high">清晰（高画质）</option>
          </select>
          <div class="hint" id="cam-preset-desc">平衡：640×480，中等码率，适合大多数场景。</div>
        </div>
        <div class="field field-slider">
          <label for="cam-brightness">亮度：<span id="cam-brightness-value">0</span></label>
          <input id="cam-brightness" type="range" min="-2" max="2" value="0" />
        </div>
        <div class="field field-slider">
          <label for="cam-contrast">对比度：<span id="cam-contrast-value">0</span></label>
          <input id="cam-contrast" type="range" min="-2" max="2" value="0" />
        </div>
        <div class="field field-slider">
          <label for="cam-saturation">饱和度：<span id="cam-saturation-value">0</span></label>
          <input id="cam-saturation" type="range" min="-2" max="2" value="0" />
        </div>
        <div class="field field-toggle-group">
          <label class="toggle">
            <input type="checkbox" id="cam-hmirror" />
            <span>水平镜像（镜头装反时使用）</span>
          </label>
          <label class="toggle">
            <input type="checkbox" id="cam-vflip" />
            <span>垂直翻转</span>
          </label>
        </div>
        <div class="field field-toggle-group">
          <label class="toggle">
            <input type="checkbox" id="cam-aec" />
            <span>自动曝光 AEC</span>
          </label>
          <label class="toggle">
            <input type="checkbox" id="cam-agc" />
            <span>自动增益 AGC</span>
          </label>
          <label class="toggle">
            <input type="checkbox" id="cam-awb" />
            <span>自动白平衡 AWB</span>
          </label>
        </div>
        <div class="field">
          <label for="cam-wb-mode">白平衡模式：</label>
          <select id="cam-wb-mode" class="top-pill-input">
            <option value="0">自动</option>
            <option value="1">晴天</option>
            <option value="2">阴天</option>
            <option value="3">办公室</option>
            <option value="4">家居</option>
          </select>
        </div>
        <div class="field field-slider">
          <label for="cam-ae-level">曝光补偿：<span id="cam-ae-level-value">0</span></label>
          <input id="cam-ae-level" type="range" min="-2" max="2" value="0" />
        </div>
        <div class="field field-slider">
          <label for="cam-light">补光灯亮度：<span id="cam-light-value">0</span></label>
          <input id="cam-light" type="range" min="0" max="255" value="125" />
        </div>
        <div class="field">
          <label for="ota-file">ESP32-CAM 固件升级：</label>
          <input id="ota-file" type="file" accept=".bin" />
          <button id="ota-upload-btn" class="small-btn">本地文件升级</button>
          <button id="ota-fetch-latest-btn" class="small-btn">从路由器一键升级</button>
          <button id="ota-open-repo-btn" class="small-btn">打开固件仓库</button>
          <div class="hint" id="ota-status">可以手动选择编译生成的 .bin 文件，或直接从路由器提供的最新固件一键升级。</div>
        </div>
        <div class="field">
          <label for="router-base">固件服务器（可选）：</label>
          <input
            id="router-base"
            class="top-pill-input"
            type="text"
            value="http://192.168.31.1:8099"
            placeholder="如 http://192.168.31.1:8099"
          />
          <div class="hint">
            默认使用 <code>http://192.168.31.1:8099</code>。CI 会在
            <code>http://192.168.31.1:8099/firmware/esp32cam-latest.bin</code>
            提供最新固件，一般无需修改此项。
          </div>
        </div>
        <button id="cam-advanced-apply" class="small-btn">
          <span class="btn-icon apply-icon"></span>
          <span class="btn-text">应用到摄像头</span>
        </button>
      </section>
    </div>
  </div>

  <script src="main.js?v=20251122"></script>
</body>
</html>
